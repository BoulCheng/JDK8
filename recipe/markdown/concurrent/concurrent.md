


### CAS的问题
- ABA问题
    - boolean变量标示是否更新过
    - int版本号追踪引用的整个变化过程
- 并发更新(写)非常大时自旋时间长
    - 破坏for死循环，当超过一定时间或者一定次数时break
    - 将一个变量拆分为多个变量分散热点
    - 使用JVM能支持处理器提供的pause指令来提升效率。pause指令有两个作用：第一，它可以延迟流水线执行指令（de-pipeline），使CPU不会消耗过多的执行资源，延迟的时间取决于具体实现的版本，在一些处理器上延迟时间是零；第二，它可以避免在循环的时候因内存顺序冲突（Memory Order Violation）而引起CPU流水线被清空，从而提高CPU的实行效率
- 只能对一个共享变量执行操作
    - AtomicReference类来保证引用对象之前的原子性，以原子方式更新对象引用 
    - 把多个变量放在一个对象里来进行CAS操作
    
    
    
无锁编程（lock free）
常见的无锁编程（lock free）一般是基于CAS(Compare And Swap)+volatile 结合实现：（1）CAS保障操作的原子性，volatile 保障内存的可见性。

优点：
1、开销较小：不需要进入内核，不需要切换线程；

2、没有死锁：总线锁最长持续为一次read+write的时间；

3、只有写操作需要使用CAS，读操作与串行代码完全相同，可实现读写不互斥。

缺点：
1、编程非常复杂，两行代码之间可能发生任何事，很多常识性的假设都不成立。

2、CAS模型覆盖的情况非常少，无法用CAS实现原子的复数操作    